<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <style>
        p{
            margin-top:10px; 
        }
        .top{
            padding: 10px;
        }
    </style>
    <title>增删改查</title>
</head>
<body>
    <div>
        <div class="top" style="text-align: center"><button  type="button" data-toggle="modal" data-target="#myModal" class="btn btn-info">添加</button></div>
        <div class="container">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>编号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>得分</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody >
                    <tr>
                        <th scope="row">1</th>
                        <td>于瑞鹏</td>
                        <td>11</td>
                        <td>12312312312312</td>
                        <td>烟台</td>
                        <td>
                            <button type="button" class="btn btn-primary">修改</button>
                            <button type="button" class="btn btn-danger">删除</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
      <!-- Modal -->
      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
                    <p>姓名</p>
                    <input type="text" class="form-control" id="exampleInputEmail1" placeholder="姓名">
                    <p>性别</p>
                    <input type="tel" class="form-control" id="exampleInputEmail1" placeholder="性别">
                    <p>得分</p>
                    <input type="text" class="form-control" id="exampleInputEmail1" placeholder="得分">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal -->
      <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body modal2">
                    <p>姓名</p>
                    <input type="text" class="form-control name2" id="exampleInputEmail1" placeholder="姓名">
                    <p>性别</p>
                    <input type="tel" class="form-control sex2" id="exampleInputEmail1" placeholder="电话">
                    <p>得分</p>
                    <input type="text" class="form-control score2" id="exampleInputEmail1" placeholder="地址">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn changeBtn btn-primary btn">Save changes</button>
            </div>
          </div>
        </div>
      </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script >
        var IndexModule = (function(){
        var oBox = document.getElementsByTagName("tbody")[0];
		function bindHTML(data){
			var str = '';
			for(var i = 0;i < data.length;i++){
                str+='<tr>'
                str+='<th scope="row">'+data[i].id+'</th>'
                str+='<td>'+data[i].name+'</td>'
                if(data[i].sex){
                    str+='<td>男</td>'
                }else{
                    str+='<td>女</td>'
                }
                str+='<td>'+data[i].score+'</td>'
                str+='<td>'
                str+='<button type="button" class="btn btn-primary btn2" data-toggle="modal" data-target="#myModal1" data-id = "'+data[i].id+'">修改</button> &nbsp;'
                str+='<button type="button" class="btn btnDel btn-danger" data-id = "'+data[i].id+'">删除</button>'
                str+='</td>'
                str+='</th>' 
                str+='</tr>'   
			}
			oBox.innerHTML = str;
		}
		function bindEvent(){
			$.ajax({
                url:'http://localhost:8000/getlist',
                type:'get',
                dataType:'json',
                success:function(res){
                    if(res.result.code === 10002){
                        bindHTML(res.result.data);
                    }
                }
            });
		}
		function init(){
			bindEvent();
            $("body").on("click",".btn2",function(){
                var id = $(this).attr("data-id")
                $(".modal2").attr("data-id",id)
                getonelist(id);
            })
            $("body").on("click",".btnDel",function(){
                var id = $(this).attr("data-id")
                Deletelist(id);
            })
            $("body").on("click",".changeBtn",function(){
                
                changelist($(".modal2").attr("data-id"),$(".name2").val(),$(".sex2").val(),$(".score2").val())
            })
		}
        function addlist(){
            $.ajax({
                url:'http://localhost:8000/getlist',
                type:'post',
                data:{
                    name:name,
                    sex:sex,
                    score:score
                },
                dataType:'json',
                success:function(res){
                    console.log(res)
                    if(res.result.code === 10002){
                        bindHTML(res.result.data);
                    }
                }
            });
        }
        function changelist(id,name,sex,score){
            $.ajax({
                url:'http://localhost:8000/changeInfo',
                type:'post',
                dataType:'json',
                data:{
                    id:id,
                    name:name,
                    sex:sex,
                    score:score
                },
                success:function(res){
                    console.log(res)
                    if(res.result.code === 10002){
                        bindHTML(res.result.data);
                        $('#myModal1').modal('hide')
                    }
                }
            });
        }
        function Deletelist(id){
            $.ajax({
                url:'http://localhost:8000/removeInfo',
                type:'get',
                dataType:'json',
                data:{
                    id:id
                },
                success:function(res){
                    console.log(res)
                    if(res.result.code === 10002){
                        bindHTML(res.result.data);
                    }
                }
            });
        }
        function getonelist(id){
            $.ajax({
                url:'http://localhost:8000/getInfo',
                type:'get',
                data:{
                    id:id
                },
                dataType:'json',
                success:function(res){
                    $(".name2").val(res.result.data[0].name)
                    if(res.result.data[0].sex){
                        $(".sex2").val("男") 
                    }else{
                        $(".sex2").val("女")    
                    }
                    
                    $(".score2").val(res.result.data[0].score)
                }
            });
        }
		return {
			init:init
		}
	})();
	IndexModule.init();


    // $('#myModal').modal('hide')
    </script>
</body>
</html>